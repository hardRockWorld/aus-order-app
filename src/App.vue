<script setup>
import { ref, watch, computed } from 'vue';
import { RouterLink, RouterView, useRouter, useRoute } from 'vue-router';
import { useSessionStore } from './stores/userSessionStore';
const { isLoggedIn, logout } = useSessionStore();
const router = useRouter();
const route = useRoute();
const path = computed(() => route.path);

const proxyIsLoggedIn = ref(false);

// watch works directly on a ref
watch(isLoggedIn, (newVal, oldVal) => {
  proxyIsLoggedIn.value = newVal;
  if(!newVal) {
    router.push('login');
  }
});
</script>

<template>
  <header>
    <nav>
      <ul>
        <li><RouterLink class="logo-link contrast" to="/">ORDERS</RouterLink></li>
      </ul>
      <ul>
        <li><RouterLink to="orders" v-if="proxyIsLoggedIn" class="contrast">Order List</RouterLink></li>
        <li><RouterLink to="login" v-if="!proxyIsLoggedIn && path != '/login'" class="contrast">Login</RouterLink></li>
        <li v-if="proxyIsLoggedIn"><a href="#" @click.prevent="logout" class="contrast">Logout</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <RouterView />
  </main>

  <footer>
    <div class="footer">
      <small>Made with ðŸ’› by <a href="https://in.linkedin.com/in/soumitri-pattnaik-69766a112" target="_blank">Soumitri</a></small>
    </div>
  </footer>
</template>


<style scoped>
.logo-link {
  text-decoration: none;
}
nav {
  border-bottom: solid 1px gray;
}

nav ul {
  margin-left: 10px;
  margin-right: 10px;
}

.footer {
  margin: auto;
  width: 100vw;
  text-align: center;
}
.footer small {
  font-size: small;
}
</style>